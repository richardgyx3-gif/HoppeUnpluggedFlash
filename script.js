// Hoppe语录闪卡网站 - 主要JavaScript功能

class HoppeFlashcards {
    constructor() {
        this.data = null;
        this.currentIndex = 0;
        this.currentQuotes = [];
        this.filteredQuotes = [];
        this.activeChapterId = null; // 当前选中的章节ID
        
        // DOM元素
        this.elements = {
            loading: document.getElementById('loading'),
            sidebar: document.getElementById('sidebar'),
            sidebarBackBtn: document.getElementById('sidebarBackBtn'),
            menuToggle: document.getElementById('menuToggle'),
            hoppeIntroBtn: document.getElementById('hoppeIntroBtn'),
            chapterNav: document.getElementById('chapterNav'),
            flashcard: document.getElementById('flashcard'),
            chapterName: document.getElementById('chapterName'),
            question: document.getElementById('question'),
            answer: document.getElementById('answer'),
            randomBtn: document.getElementById('randomBtn'),
            nextBtn: document.getElementById('nextBtn'),
            prevBtn: document.getElementById('prevBtn'),

            hoppeInfoModal: document.getElementById('hoppeInfoModal'),
            hoppeInfoClose: document.getElementById('hoppeInfoClose'),
            toast: document.getElementById('toast')
        };
        
        this.init();
    }
    
    async init() {
        try {
            await this.loadData();
            this.setupEventListeners();
            this.setupNavigation();
            
            // 默认侧边栏关闭，用户点击按钮打开
            
            this.updateDisplay();
            this.hideLoading();
            this.showToast('欢迎来到Hoppe语录！', 'success');
        } catch (error) {
            console.error('初始化失败:', error);
            this.showToast('加载数据失败，请刷新页面重试', 'error');
        }
    }
    
    async loadData() {
        try {
            // 直接嵌入数据，避免跨域问题
            this.data = {
                "title": "Hoppe不插电 - 自由主义语录",
                "description": "Hans-Hermann Hoppe教授的政治哲学语录集，包含国家和政府本质的深度思考",
                "chapters": [
                    {
                        "id": "essence",
                        "title": "国家的本质",
                        "subtitle": "The Essence of the State",
                        "quotes": [
                            {
                                "id": "1.1",
                                "question": "为什么国家是一个奇特的机构？",
                                "answer": "国家今天似乎被视为理所当然。任何质疑它的人都很少被认真对待。然而这正是我们想要做的。我们想要思考国家的本质。\n\nHoppe从一个思维实验开始：\n\n如果你对一群蹒跚学步的孩子说：我们五个人，时不时会有冲突。为了解决我们的争吵，我们任命朱利乌斯当裁判。总是由朱利乌斯来决定谁是对的，即使朱利乌斯也参与了冲突。那么每个幼儿园小组都会理解这是解决问题的一个非常危险的方案。\n\n现在，如果你思考国家是什么，即在包括国家本身参与在内的所有冲突案例中的最终决策者，那么你立即意识到这只是一个荒谬的结构。"
                            },
                            {
                                "id": "1.2",
                                "question": "国家是通过自愿协议建立起来的吗？",
                                "answer": "也许你们中的一些人已经听说过所谓的社会契约理论。这个理论的基本思想是，今天生活在国家中的每个人都通过合同明确地（实际上他签署了合同）或隐含地（通过所谓的'默许同意'）同意了这个国家的存在。这个与国家签订的合同应该为国家提供科学和道德上的正当性。\n\nHoppe说这是胡说八道：\n\n不，国家恰恰不是合同的结果！明智的人不会同意这样的安排。我的档案中有很多文件，但你不会在任何地方找到那份文件（合同）。\n\n国家是侵略性暴力和征服的结果。它没有任何合同基础就出现了，就像一伙保护勒索者一样。"
                            },
                            {
                                "id": "1.3",
                                "question": "为什么说“我们是国家”是错误的？",
                                "answer": "每个人都听过“我们，人民”就是国家这样的话。毕竟，我们选举我们的领导人和立法者，有时甚至在公投中投票。但这真的是真的吗，我们真的是国家吗？\n\nHoppe明确声明：不，这是一种错觉。有私营部门和公共部门，有两套不同的法律。换句话说，国家创造法律不平等。\n\n在所有社会中都有私法和公法的区别。如果我作为私人从你那里拿走什么东西或强迫你为我工作，我会被罚款甚至监禁。但，如果我作为公务员这样做，它被认为是“征税”或“强制征兵”。\n\n作为公共雇员，我被允许做我作为私人永远不会做的事情。那些被称为“偷窃和兜售赃物”的事情，如果由国家实施，就被认为是实施社会政策。"
                            },
                            {
                                "id": "1.4",
                                "question": "我们的政治制度和黑手党有什么共同点？",
                                "answer": "我们在学校了解到，政府滥用被所谓的权力分立所防止。立法机关（国会）制定法律，行政机关（总统）执行法律，司法机关（最高法院）确保每个人都遵循规则。这些制衡机制应该让政府的每个分支都监视其他分支。\n\nHoppe说这只是错觉，权力分立并不存在。他论证道：\n\n在目前的情况下，如果公民和国家之间发生冲突，总是由国家决定谁是对的。例如，如果国家决定我欠他们更多税款，或者他们禁止我在我的餐厅吸烟，而我不同意，我能做什么？我只能去州法院，那里的法官本身也由税收供养。这些法官可能作出什么判决？当然，法官会说这是合法的！\n\n假设你是国家元首。为了自我监管，你任命你的叔叔为法官，你的阿姨为财务主管，你的父亲是伦理委员会主席。这就是权力分立。当然，家族内部偶尔会有分歧。但你们都有共同的利益，即最大化组织的收入和扩大权力。\n\n即使在黑手党内部也有具有“行政”、“立法”和“司法”职能的人。要明白这一点，只需重新观看电影“教父”即可。"
                            },
                            {
                                "id": "1.5",
                                "question": "民主决策在多大程度上导致共产主义结果？",
                                "answer": "在1848年的《共产党宣言》中，共产主义被定义为“废除私有财产”。在共产主义国家，这意味着国家计划委员会有权决定人们生活的所有方面，从教育到工作、住房、旅行和媒体消费。Hoppe指出，通过民主决策也会发生同样的事情。\n\n重点：当Hoppe使用“财产(property)”一词时，他指的是对财货和对自己身体的处置权。在这个意义上，自己的身体也是一种商品。\n\n是的，当然，民主，无论是直接的还是间接的，都是共产主义的一种形式。多数人决定什么属于我，什么属于你，什么你可以做或不能做。这与私有财产无关，而与限制私有财产息息相关，换句话说，与共同财产有关。而共同财产又意味着共产主义。\n\n我们与国家没有合同，也没有法律保证什么属于我们，什么是我们自己的不可侵犯的财产。例如，当有所得税和财产税的时候，最终属于你的财产的是什么？国家决定不征税保留给你的那部分。"
                            },
                            {
                                "id": "1.6",
                                "question": "为什么Hoppe将他的一本书命名为“骗子的竞争”？",
                                "answer": "经济领域的自由竞争意味着我可以卖我想卖的，我可以买我想买的。这让消费者能够根据他们自己的个人需求购买最好或最便宜的产品。反过来，这意味着只有最好的生产者得到奖励并变得成功。\n\n政治中也存在竞争。然而，这个竞争不是为了向消费者提供商品和服务，而是为了赢得大众支持和获得有权力的职位。Hoppe说，政治竞争与经济竞争完全相反：\n\n竞争并不总是好的。只有在商品生产中的竞争才是好的。相比之下，在“坏事”的生产中的竞争是坏的，实际上还比坏更坏。我们不希望在谁能最好地打败我们方面存在竞争。民主和政治竞争也是如此。民主允许大多数人通过法律国家权力手段占有他人的财产，这归根结底是合法的盗窃。\n\n在大规模选举中存在一种倾向，社会某些成员寻求进入公共职位并上升到最高层级，他们在夺取他人财产这件事上没有道德的限制。\n\n进行国家官员选举的政治单位越大，人和人之间越不熟知，政治就越被嫉妒心和对权力的渴望操纵。"
                            },
                            {
                                "id": "1.7",
                                "question": "民主有利于和平变更政府吗？",
                                "answer": "就所谓的民主和平变更政府的优势而言，就算通过定期组织的抽签选择国家官员，也可以和平地变更政府。\n\n虽然抽签会让一些“偶然的”权力持有者来做统治者，但“民主竞争”提供了一个实质上的保证——只有“最好的”权力持有者、最具操纵性和最狡猾的政治家才能上升到国家权力的决定性地位。"
                            }
                        ]
                    },
                    {
                        "id": "history",
                        "title": "政府与历史",
                        "subtitle": "Governments and History",
                        "quotes": [
                            {
                                "id": "2.1",
                                "question": "民主制的管理者，还是君主制的所有者对人们更好？",
                                "answer": "我们做任何事都受激励（incentives）的影响，我们问自己“我如何获得，我将在哪里失去？”当然，对政治家来说也是如此，这使得比较国王和民主政治家的激励变得有趣：\n\n在君主制国家，每个人都知道谁是统治者，谁是被统治者，因此任何扩展国家权力的企图都有阻力。在民主国家，统治者和被统治者之间的对比变得模糊，国家权力可以更容易地扩展。\n\n君主想要将他的国家传给家族中的继承人；他着眼于长期的财富保存。另一方面，民选政治家只是临时管理者，所以他们只考虑短期的事。\n\n以两个相同的房子为例：一个由业主居住，也可以传下去，另一个由租户居住，合同只运行五年。谁会更好地对待房子？\n\n尽管我对经典君主制有明显同情，但我不是君主主义者。经典君主制和现代民主都只是国家的存在形式。"
                            },
                            {
                                "id": "2.2",
                                "question": "古典自由主义获胜了吗？",
                                "answer": "古典自由主义的中心目标是确保所有人的平等——每个人在法律面前都是平等的，这与之前存在的王权或封建特权形成对比。\n\n就所谓成功而言，必须得出结论：目标完全错失了。\n\n今天我们离实现这些古典自由主义目标比150年或100年前更远。自那时以来发生的巨大技术进步不应使我们对这个事实视而不见。我们没有接近自由主义目标，实际上，西方世界越来越走向相反的方向，即共产主义目标：废除私有财产和建立“公有经济”。\n\n对这一事实的解释是：150年前，《共产党宣言》中提出的要求仍然被认为是令人发指和完全荒谬的。例如，无限制普选权的要求（21岁起），要求由税收支付的'人民代表'选举，'免费'即税收资助的'人民教育'和'司法保障'，国家保证最低收入的要求，国家央行和纸币的要求，强力累进所得税和财产税的要求，或限制继承权的限制。"
                            },
                            {
                                "id": "2.3",
                                "question": "像欧盟这样的大型政治实体有利于经济繁荣吗？",
                                "answer": "让我从显而易见的事实开始。像摩纳哥、列支敦士登、安道尔、（曾经的）香港、新加坡，甚至相对较大的瑞士，所有这些地方在经济上都比周围面积较大的地区做得更好。\n\n此外，在1871年统一之前，德国在19世纪成为在文化和科学上领先的国家，这归功于它的39个互相竞争的公国的政治分裂。这与严重集中的法国形成对比，在法国文化只产生于巴黎，国家的其余部分以文化黑暗为特征。德国的小地区间竞争激烈，每个地方都想要最好的图书馆、剧院和大学。\n\n小国必须实施低税收和低监管政策，否则他们最有生产力的公民会直接离开。\n\n我们应该摆脱经济学是不同国家或国家之间的事情的想法。经济活动发生在人与人之间以及公司之间。国家不与国家竞争，而是公司与公司竞争。"
                            },
                            {
                                "id": "2.4",
                                "question": "民主还是独裁更有利于经济繁荣？",
                                "answer": "有人说民主最有利于经济繁荣，其他人声称发展中国家需要一只“强有力的手”和政府领导。Hoppe说两者都是错误的：\n\n正如委内瑞拉目前的例子清楚地显示的那样，民主和民主选举可能导致私有财产权、合同与贸易自由的几乎完全废除，这能导致令人震惊的经济崩溃。\n\n在这方面同样具有启发性的是，将印度的经济与中国的经济进行比较。现代印度几乎在七十年间一直由民主政府统治，而现代中国由共产党统治。虽然这两个国家的经济状况直到1980年代初都同样绝望，但自中国“改革共产主义”开始以来，中国的人均GDP显著超过印度的人均GDP，这表明中国有更大的经济自由。\n\n因此，结论是，你既不应依赖民主，也不应依赖独裁。把你的希望寄托在激进的政治分权上；不仅在印度和中国，而且在各地。"
                            },
                            {
                                "id": "2.5",
                                "question": "瑞士民主有什么特殊之处？",
                                "answer": "至于瑞士的特殊情况：好吧，民主最多只能“半途而废”地运作。在非常小的且文化同质的社区中，民主不会很快以经济毁灭告终。\n\n在每个人都认识每个人并意识到他们的社会地位的地方，在因此存在明显的社会压力的地方，想要通过“民主手段”获得他人的财产是很困难的。即使这在理论上是可能的，社会压力也会阻止这种事情发生。\n\n瑞士的民主（仍然）很大程度上是地方民主。地方事务由地方决定，没有“外部”或“上面”（来自伯尔尼、布鲁塞尔、华盛顿或纽约）的干预。\n\n因此，瑞士相对于其大邻国的相对经济成功与其直接民主几乎没有或根本没有任何关系，而是与瑞士民主是一个“小”民主有关。\n\n这是瑞士的秘密。"
                            }
                        ]
                    },
                    {
                        "id": "activities",
                        "title": "国家活动",
                        "subtitle": "State Activities",
                        "quotes": [
                            {
                                "id": "3.1",
                                "question": "“盗贼王子”罗宾汉，是英雄还是恶棍？",
                                "answer": "罗宾汉的传说有两个不同的版本。他要么从富人那里偷东西，要么抢劫税收员。你认为Hoppe站在哪一边？\n\n税收是盗窃。小偷——国家及其代理人和盟友——自然试图掩盖这个事实。\n\n显然，税收不是商品和服务的正常自愿支付，因为你不能在对产品不满意的情况下停止这些支付。如果你停止购买大众汽车或香奈儿香水，你不会受到惩罚，但如果你停止为州立学校或大学或某些政治家的华丽买单，你会被投入监狱。\n\n既然税收是盗窃，即一种不公正，那么拒绝向小偷支付，或拒绝就你的收入或财富向他们撒谎在道德上并不是错误的。但这并不意味着这样做是明智或谨慎的。毕竟，国家是如尼采所说的，是一切冷怪物中最冰冷的。如果你违抗它的命令，它可能会毁掉你的生活并摧毁你。"
                            },
                            {
                                "id": "3.2",
                                "question": "什么是公正的税收？",
                                "answer": "如果税收是盗窃，那么从正义的角度来看，根本不应有税收和税收政策。\n\n政府雇员和所有依赖国家的人实际上根本不交税。相反，他们的净收入（指，减去税收后）都来自税收收入，因此他们不是税收支付者，而是税收消费者，他们的收入来自从其他人——税收生产者那里窃取的资源。\n\n“最好”（因为最低）的税收是人头税，每个人必须支付相同的固定税额。由于即使最穷的人也必须能够支付这个数额，这样的税收必须非常低。尽管如此，即使人头税也是盗窃，对盗窃来说没有什么是公平的。\n\n一个重要步骤是，如果雇主停止代表国家收取工资税。公司应该说：“我们不为你做这项工作。如果你要收税，你自己收。” 如果每个人都必须在年底亲自支付税收，抵抗会比现在高得多。\n\nHoppe有时这样说明这一点：如果国家雇员或依赖者停止支付税收，他们将有更多钱可花，国家相应地更少。如果私营部门纳税人停止支付税收，国家，包括其所有依赖者，根本不会有任何资金可用。"
                            },
                            {
                                "id": "3.3",
                                "question": "社会保障是一个伟大的成就吗？",
                                "answer": "国家养老金通常被称为“代际契约”。其想法是，现在工作的人为今天的退休人员的支付养老金，并期望未来的工作者在他们退休时为他们做同样的事情。\n\nHoppe说，整个社会保障系统，即所谓的“代际契约”，就像一个注定崩溃的连锁信。\n\n任何想要提供这种“保险计划”的私营商人都会立即被逮捕作为一名骗子。而政治家在世界各地仍然假装他们处理的是一个伟大的成就，甚至在面对不断上升的预期寿命和下降的出生率时，这只显示我们的整个政治阶级多么不负责任，甚至在杀人。"
                            },
                            {
                                "id": "3.4",
                                "question": "退休规划的正确基础是什么？",
                                "answer": "从经济和道德角度来看，一个人的老年保障（退休养老金）应该是一个纯粹私人的事情。\n\n当然，这样的安排不会消除与老年相关的所有问题。然而，这种安排通常通过奖励勤奋和远见，同时惩罚疏忽和短视来加强个人责任。因此，它倾向于将与衰老相关的财务和社会问题减少到人类可能的最低水平。\n\n与此形成鲜明对比的是，在西方世界，退休保障越来越多，并实际上几乎完全成为国家事务。结果是，体面、家庭关系和个人责任被系统性地削弱。\n\n老年保障是民主制如何将许多人变成小孩的典型例子。他们相信，如果选对了人，如果印刷了货币，如果财富从一个群体重新分配到另一个群体，所有问题都能快速简单地解决。这在他们内心助长了一种幼稚的心理。"
                            },
                            {
                                "id": "3.5",
                                "question": "政治家对穷人更有同情心吗？",
                                "answer": "如果你作为私人偷东西，然后把它作为礼物送给另一个人，这意味着你是一个兜售赃物的小偷。而如果你作为公务员这样做，它被称为社会政策。\n\n从某些人那里拿走金钱和东西，再把这些赃物给其他人。做这件事的人——你熟知的政治家和官僚——当然极其慷慨，因为这不是他们自己的钱，而是从别人那里偷来的钱。用别人的钱，慷慨很容易，用你自己的钱，你通常会更谨慎一些。\n\n当然，政治家是骗子：他们靠在暴力威胁下从别人那里勒索的钱生活，这被称为'税收'。\n\n不幸的是，政治家并不懒惰。如果他们什么都不做只是挥霍他们的战利品就好了，相反，他们是妄自尊大的慈善家，他们通过成千上万的法律法规让受害者的生活更加困难。"
                            },
                            {
                                "id": "3.6",
                                "question": "社会政策究竟如何让社会更贫穷？",
                                "answer": "福利国家总是对繁荣和增长有害。\n\n任何税收都意味着财富和收入被强制从其所有者和生产者那里拿走，并重新分配给不拥有这些资产且没有生产这些收入的人。任何未来的财富增长和任何未来的收入生产因此受到惩罚，结果导致人口的总体财富比没有福利国家时更低。\n\n慈善的自愿的援助是完全不同的东西。参与慈善工作的人将继续保持生产力，因为他们选择亲自帮助。\n\n另一方面，如果我被迫帮助穷人，这对我自己的生产活动有负面激励。对收钱的一边来说，摆脱他们凄凉处境的激励也更低。"
                            },
                            {
                                "id": "3.7",
                                "question": "印刷货币能创造财富吗？",
                                "answer": "国家只允许其央行创造和调节货币，且这种货币的质量也很差。\n\n在以前我们还有黄金或银子，而如今我们在全球范围内只有纸币（美元、欧元、日元等）。这对垄断者来说太棒了，他可以免费印刷货币来购买昂贵的商品，如房屋和汽车。一根真正的魔法棒！谁不希望拥有这样的魔法棒？\n\n但每产生一张新的纸币都导致所有其他现有纸币的购买力下降。每新印刷的纸币都会导致财富重新分配。那些首先获得新货币的人，如与央行有最紧密联系的大银行，会变得更富有。他们在社会财富中的份额增加了。他们现在拥有以前没有的房屋和汽车。同样，他们减少所有其他人的财富，其他人现在拥有相应更少的房屋和汽车。\n\n印更多纸币不能使社会更富，更多的货币就是印刷更多的纸。\n\n任何国家都可以印刷任何数量的货币。如果印刷货币能让国家变得更富，我们如何解释为什么世界上仍然有穷国和穷人？毕竟，货币可以无限量印刷。"
                            },
                            {
                                "id": "3.8",
                                "question": "知识产权能被偷吗？",
                                "answer": "知识产权是一种法律赋予发明者的权利，用以决定谁可以使用其发明。因此，发明者在一定时期内被授予国家保护的垄断权。一些著名的例子是药品的专利保护，以及音乐、图片和文本的版权。\n\nHoppe说这个政策是错误和有害的：\n\n知识产权的想法不仅是错误和混乱的，更重要的是它还非常危险。好的想法——食谱、公式、旋律等——当然是商品(goods)。但它们不是稀缺商品。一旦它们被思考和表达，它们就是“免费的”、无穷无尽的商品(goods)。我吹口哨或写诗，你听到旋律或读到诗，然后重复旋律或誊抄诗。全世界都可以模仿我，但没有什么从我身上拿走。\n\n如果我不想让任何人抄袭我的想法，我只需要将它们保密，永远不要发表它们。"
                            },
                            {
                                "id": "3.9",
                                "question": "专利保护和版权的逻辑后果是什么？",
                                "answer": "现在想象一下，如果我被授予对我的旋律或诗歌拥有产权，即，我可以禁止你抄袭我或坚持让你支付版税。\n\n首先，这导致一个荒谬的结果，我必须首先向发明吹口哨和写作的人（或他们的后代）支付费用，以及向那些第一次发出声音和第一次说话语言的人等等。\n\n其次，如果我能阻止你吹我的旋律或背诵我的诗歌，那么我就获得了对你财产的部分控制权，你的物理身体、声带、纸张、铅笔等等。毕竟，你除了使用你自己的财产外没有使用其他任何东西来抄袭我。\n\n这证明：知识产权必须被视为对所有真正财产权的高度危险的攻击。"
                            }
                        ]
                    },
                    {
                        "id": "problems",
                        "title": "当前问题",
                        "subtitle": "Current Problems",
                        "quotes": [
                            {
                                "id": "4.1",
                                "question": "冠状病毒不是证明政府监管是必要的吗？",
                                "answer": "恰恰相反。人们试图由中央来解决这个问题，然而各个城市随后表示当地情况各异，或更为严峻，或没那么严重。各州州长和地方长官有绝佳机会，通过无视、强化或以其他方式修改中央政府的措施，来扩大自己的权力范围。在德国，有时人们甚至无法跨越州界，前往自己的度假屋。\n\n想象一下，如果我们有一个世界政府在各地发布统一的措施。这对人们来说似乎完全疯狂，因为德国不是刚果，中国不是日本。\n\n无论中央还是地区的政策制定者很大程度上免于为错误决定和由此产生的成本负责。他们声称这是在 “健康” 与 “经济” 之间寻求平衡的问题，却没有意识到或不愿承认，恰恰是社会中的贫困阶层以及那些受封锁措施影响最大的人群，尤其是在健康方面受损严重。\n\n尽管对个人自由行动的限制几乎完全延伸到了私人家庭中，大多数政策制定者仍然被视为救世主而不是纵火犯。\n\n我认为在这件事的发展中显露出来的政治顺从程度是非常令人不安的。"
                            },
                            {
                                "id": "4.2",
                                "question": "欧盟出了什么问题？",
                                "answer": "最初的想法是一个自由贸易区，但自由贸易区只需要两句话：无论你希望出口什么，你都可以出口；无论你想进口什么，你都可以进口。\n\n你不需要数万或数十万页的文件告诉你去生产什么，如何生产，什么地方你可以或不可以运输东西等等。\n\n但这从一开始就几乎被遗忘了。欧洲至今没有自由贸易。例如，如果你在德国看电视，你会不断发现，德国边防又逮捕了一批走私在波兰税率较低的香烟的人。\n\n我们可能不得不见证葡萄牙、西班牙、意大利，最终是德国的破产。我担心，只有到那时，甚至最后一个人才会意识到许多人早已怀疑的事：欧盟不过是一个大规模重新分配收入与财富的机器；从德国和荷兰流向希腊、西班牙、葡萄牙等等，而且始终遵循着同样不合理的模式；从生产力较高的国家、地区、地方、公司和人群，重新分配到生产力较低或毫无生产力的对象那里。破产将把这一切残酷地暴露出来。"
                            },
                            {
                                "id": "4.3",
                                "question": "欧盟是一个和平项目吗？",
                                "answer": "当欧盟受到批评时，其辩护者经常用“至少我们在欧洲没有战争”这一说法来反驳。Hoppe说这与欧盟几乎没有关系：\n\n欧洲没有战争的原因是，欧洲基本上由美国附庸国组成。当然，美国会确保其附庸国之间没有大战，苏联也为其附庸国做了同样的事情。欧盟这个机构本身对和平没有贡献。\n\n维持和平需要的是进行自由贸易。\n\n此外，主权小国如果把事情搞砸了，不能总是归咎于他人。这对各国人民之间的关系有缓和作用。目前，责任总能被推给其他国家。在欧盟，布鲁塞尔常因各种问题受到指责。\n\n在欧洲，政治中心化没有导致对希腊人或西班牙人的更多喜爱，恰恰相反。"
                            },
                            {
                                "id": "4.4",
                                "question": "为什么Hoppe支持脱欧？",
                                "answer": "英国于1969年加入欧盟。2016年，多数选民在公投中选择了离开。这个决定与许多困境有关。\n\n二次投票是对公民的嘲弄。这正是之前在丹麦和荷兰发生过的事情，选民们被要求投票，直到他们得出“正确”结果——根据政治精英的标准衡量的“正确”结果。\n\n英国在传统上是最致力于自由贸易的国家。如果你看看英国人的诉求：我们希望英国的法律由英国人制定，我们希望与欧盟和欧盟以外的所有国家自由贸易，我们希望结束无限制移民。这又有何不合理之处？\n\n这些诉求当然被欧盟激烈反对，原因很简单，因为英国一旦成功脱欧，然后其他国家也会脱欧。\n\n因此，欧盟拒绝允许货物免税进入欧盟。这伤害了欧洲人，让他们不能从英国获得便宜的商品。当然，除了政治家，他们从关税获得了收入。"
                            },
                            {
                                "id": "4.5",
                                "question": "自由贸易和自由移民是并行的吗？",
                                "answer": "古典自由主义通常要求向商品和人开放边界。毕竟，两者都是关乎自由的，对吧？\n\nHoppe说这是错误的。商品的自由和人的自由是两件不同的事情。\n\n贸易和移民现象在根本上是不同的。除非发送者和接收者同意，商品和服务不能从一个地方运送到另一个地方。而即使其他人都不希望他或她这样做，某人也可以从一个地方移动到另一个地方。因此，自由移民变成了现有人口的强制整合（forced integration）。\n\n在一个土地完全私有化的社会中，不受欢迎的移民问题不会出现。当这个条件还没有实现时，解决方案是将移民政策从联邦政府分权到州、县、村、城市和城市街区。\n\n如果政府要允许移民，它至少应该确保移民从主人家那里收到邀请（“担保人原则”）。然后，主人家必须在移民的访问期间承担全部责任。\n\n最后，自由贸易越多，移民的动机就越少。"
                            },
                            {
                                "id": "4.6",
                                "question": "物质主义破坏文化吗？",
                                "answer": "虽然有些人嘲笑物质繁荣为“物质主义”，但必须强调，只有在改善了人类生活的物质条件的基础上，人类文化才能繁荣和发展。\n\n如果没有纸和墨水、印刷机、乐器、油画颜料、画布、雕塑工具、剧院、博物馆等等，以及没有休闲时间——由物质繁荣允许和提供的时间，就不可能有作家、作曲家、音乐家、画家、雕塑家、演员等等。\n\n贬低所有这些的重要性很容易——“哦，这只是物质上的东西！”但对于那些如此关心的人，世界有很多地方他或她可以移民，但他们不去。他们不移民。\n\n那么人们想移民到哪里？没有从非洲到印度的大规模移民，却有往更富有的国家的大规模移民。\n\n *在此语境下，物质主义是一种高度看重物质财富和身份象征的生活态度..."
                            },
                            {
                                "id": "4.7",
                                "question": "我们需要更多的“社会宽容”吗？",
                                "answer": "在道德和经济上破坏我们的社会，将我们推向深渊的，不是太少宽容，而是太多宽容。\n\n我应该对想要吃掉我的食人族宽容吗？应该对想要剥夺我财产的共产党人宽容吗？应该对想要从我赚取的财富和收入中收一半税的社会主义者宽容吗？应该对想要通过选票剥夺和使我贫困的民主党人宽容吗？或者为了拯救青蛙的生命而剥夺我财产权的绿党？我不这么认为。在那之前，事实上在远未到那一步之前，我的忍耐就已到极限了。"
                            },
                            {
                                "id": "4.8",
                                "question": "我们的医疗保健系统需要什么治疗？",
                                "answer": "以下建议在今天可能听起来激进。但是在不久前，它们就是现实。\n\n需要采取四个步骤：\n\n第一，\n取消对医学院、医院、药房、医生和所有其他医务人员的所有许可证要求。\n他们的供应几乎会立即增加，价格会下降，市场上会出现更多样化的服务。\n互相竞争的自发的认证机构（accrediting agency）将取代国家的强制许可。因为消费者不再生活在医疗保健中存在“国家标准”的幻觉中，他们会做出更有意识和批判性的选择。\n\n第二，\n消除政府对药品和医疗器械制造和销售的所有限制。\n这将终结目前阻碍创新和增加成本的医疗保健官僚机构。成本和价格会下降，更广泛更好的产品会更快地到达市场。相互竞争的药品和设备制造商和卖家会提供越来越好的产品描述和保修，既保护自己免受产品责任诉讼的同时，又吸引顾客。\n\n第三，\n医疗保险行业的全面去管制。\n平均而言，医疗保险的价格会戏剧性地下降。改革将恢复个人自行选择医疗保险的责任。保险的作用在于捆绑相同或相似的风险。我不想将我的个人意外风险与职业足球运动员的风险捆绑在一起，而我只愿与我情况相似的人捆绑，并以更低的成本。相反，今天的医疗保险行业包含一个收入再分配系统，使不负责任的客户和高风险群体受益。相应地，医保行业的价格高且稳步上升。\n\n第四，\n消除对病人或不健康者的所有补贴。\n补贴总是创造更多被补贴的东西。对不健康和生病的补贴会促进粗心、需要和依赖。如果我们消除这些补贴，我们会加强过健康生活的意愿和为自己的生计工作的意志。\n\n* 认证机构：（源于拉丁语 accredere，意为 “给予信任”）是对产品和服务质量进行监督与认证的机构（公司、基金会、协会等）。例如有机产品和公平贸易标签，或像瑞士通用公证行（SGS）这样的认证公司。在自由市场中，竞争确保胜出的机构是那些能以最高效、最可信的方式服务客户的机构。"
                            },
                            {
                                "id": "4.9",
                                "question": "关于气候变化问题的质疑是“亵渎神明”吗？",
                                "answer": "气候无论如何都会变化，无论有没有人类，数百万年来一直如此。即使人类灭绝，气候也会继续变化。\n\n几个世纪前，平均温度比今天高得多。那时候你可以在英格兰种植葡萄，在北卡罗来纳种植橙子。今天，这不再可能，因为太冷了。数千年前，河马在泰晤士河中游泳，今天在这些纬度河马只能动物园中找到。确实，寒冷时期和温暖时期相比通常对人类来说更糟。\n\n说所有或甚至绝大多数科学家在气候或气候变化上达成了一致，完全是在胡说八道。\n\n即使情况相反，国家或任何超国家（supranational）的权威试图确定“正确的”平均温度和“正确的”变化范围，都是对人类的罪行。因为对全人类来说不存在“正确”的温度，也永远不会有。"
                            }
                        ]
                    },
                    {
                        "id": "private-law",
                        "title": "私法社会",
                        "subtitle": "Private Law Society",
                        "quotes": [
                            {
                                "id": "5.1",
                                "question": "我们如何在没有国家的情况下解决人际冲突？",
                                "answer": "基本想法很简单。国家对使用暴力的垄断将被废除，也在警察和司法部门内竞争也将被允许。\n\n目前，在公民和国家间冲突的案例中，总是由国家决定谁是对的。在私法社会中，我转向独立于双方的仲裁者来解决争议。\n\n在当地争端中，如在村庄或小城镇，这些仲裁者可能是受尊重的“自然贵族”。对于更大的案件，会有法律费用保险，就像今天一样。保险人和被保险人在合同上就调解员和上诉机构达成一致。\n\n如果争端的双方是同一保险公司的客户，后者将裁定案件。如果不同的保险公司得出不同的判断，那么就会请来双方都尊重的仲裁员。最终做决定的将是这位仲裁员。\n\n这个程序清晰、简单而明确，不需要任何国家立法或司法管辖。"
                            },
                            {
                                "id": "5.2",
                                "question": "私法争端解决完全不现实吗？",
                                "answer": "就像我说的，这不是乌托邦。所有这些在国际、无政府状态的商业交易中已经是常见做法。\n\n只要看看今天如何解决跨境争端。在国际上，法律中都有一种无政府状态，因为没有世界国家来规范一切。\n\n边界三角的巴塞尔公民，即德国人、法国人和瑞士人，当他们之间发生冲突时做什么？他们首先会转向自己的司法管辖。如果不能达成一致，独立的调解人被叫来决定案件。任何不遵守他们判决的人不仅违反合同，他成为商业世界中的麻风病人，没有人会想与他做生意。\n\n这个地区的公民之间比科隆和杜塞尔多夫公民之间有更多争端吗？我从来没有听说过任何这种情况。当然，这表明人际争端可以在没有国家作为法律垄断者的情况下和平解决。\n\n另一个历史例子：在美国，在淘金热期间，制定了标准来定义挖掘者的领土。是私人人注册了这些土地主张。这表明所有权问题可以在没有国家的情况下解决。"
                            },
                            {
                                "id": "5.3",
                                "question": "用一句话来说，国家解决方案和私人解决方案的区别是什么？",
                                "answer": "如果要用一个词来表达私人组织安全行业与当前国家实践的关键区别，那么这个词就是'合同'。\n\n国家今天'提供'的东西是这样的：我不合同保证你任何事情；我不向你承诺我打算保护哪些具体事情作为'你的财产'，也不告诉你如果我认为我没有履行我的承诺，我会承担什么——无论如何，我保留单方面确定我的'服务'价格的权利，并且进一步通过立法改变当前的游戏规则，而游戏仍在进行中。\n\n想象一下，一个自由融资的、私营部门的安全提供者，无论是警察、保险商或仲裁人，向其潜在客户提出这样的提议。任何明智的人都不会接受这样的交易，公司会因为缺乏顾客而立即破产。\n\n在私法社会中，必须提供合同。这些合同必须包含所有权和明确定义的相互服务和义务的明确描述，而且，这些合同只能在它们有效期内在相互同意下才能更改。"
                            },
                            {
                                "id": "5.4",
                                "question": "国家今天保护我们保护得有多好？",
                                "answer": "众所周知，国家在打击犯罪领域效率低得惊人，因为负责这项任务的代理人支付来自税收收入，即无论生产力如何。\n\n当一个人意识到目前根本没有以任何方式赔偿受害者时，情况就变得更糟。恰恰相反。如果国家实际上抓住了罪犯，那么容纳这些恶棍和强盗的成本经常通过税收强加给受害者，然后他们每天都可以玩乒乓球并得到他们的Birchermüsli，在美国你也可以学习法律，你有大健身房，你可以加强自己，以便下次在犯罪努力中可能更成功。\n\n让我们不要忘记：正是民族国家仅在20世纪就负责数亿人的死亡和不可估量的破坏。相比之下，私人犯罪的受害者几乎可以忽略。"
                            },
                            {
                                "id": "5.5",
                                "question": "为什么私法社会会奖励和平行为？",
                                "answer": "保险公司已经必须支付犯罪造成的损害，无论是否能够抓住并追究责任人。在没有国家警察力量的私法社会，保险公司可能与私人保安公司密切合作。这种合作的重点将转向犯罪预防和恢复。\n\n私人保险公司必须在犯罪已经实施并造成损害时支付赔偿。因此保险人有兴趣追捕罪犯，因为只有这样才可能让罪犯向受害者支付赔偿。他也会擅长追回战利品，因为他不会必须替换它。如果你今天去警察那里说这个和那个被盗，你可以确定他们只会把它归档。\n\n私法社会中的保险人也会鼓励人们之间的和平行为。这是因为不是所有风险都是可保险的。你只能为你无法控制的事件保险。因此，保险人会拒绝帮助你，例如，如果你挑起了冲突。每个保险公司都会坚持其投保人必须以文明方式行事并遵守合同规则。"
                            },
                            {
                                "id": "5.6",
                                "question": "富人和恶人能否夺取权力？",
                                "answer": "事实上，毫无疑问，拥有更多财务资源的人可以负担更多，包括更多安全。但真正的问题是：私法社会与今天的国家运行社会相比，是否让富人更容易'购买'以牺牲穷人为代价的特权？对于这个问题，答案相当明显'不'，恰恰相反。\n\n富人目前持续'购买'以牺牲他人为代价的好处，通过贿赂国家权力的持有者。现在想象一下，如果国家是一个 множество竞争的保安提供者：几家保险公司、仲裁机构和警察部队。那么贿赂显然要困难得多。因为然后贿赂一个机构是不够的，但必须贿赂所有机构才能实现目标。\n\n这还不够，因为如果一个（或所有）机构得到可贿赂的声誉，那么这些机构较不富有的客户会远离他们，其他廉正机构会出现。\n\n另一方面，无论多么清楚地认识到它是腐败的，你都不能远离国家作为强制机构。因此，正是'弱者'在私法社会下比在今天的国家法律下得到更好的保护。"
                            },
                            {
                                "id": "5.7",
                                "question": "当一切都私有化时，谁保护环境？",
                                "answer": "在私法社会中，不会有抽象的'环境'，只有土地、湖泊，甚至部分海洋的私有所有权。污染总是对私有财产的损害。\n\n问题很容易解决。受伤方必须被赋予起诉权。然后他或她可以起诉污染者要求赔偿。\n\n在19世纪，公民在公司通过环境污染损害其财产时起诉公司是常见的。后来，国家限制起诉权以保护和促进某些行业。\n\n关键点是财产权必须明确分配。基本原则必须是：谁先到达谁获得财产权。例如，如果一家公司在现有住宅附近建造一个产生大量污染物排放的工厂，那么房主可以起诉要求赔偿。这是一个简单的原则，连孩子都能理解。\n\n附注：经验告诉我们国家如何对待他们的财产与私人人相比？\n\n我们可以比较国家管理的海洋和雨林与私人农场、湖泊和庄园。\n\n我们可以观察和比较国家运行的共产主义经济体与主要是私运行的西方社会。\n\n在经济学中，这个主题被称为'公共资源的悲剧'。"
                            },
                            {
                                "id": "5.8",
                                "question": "冠状病毒大流行在私法社会中会如何发展？",
                                "answer": "简而言之，Covid不会作为大流行发生。冠状病毒实际造成的感染风险非常低，大多数人不会将其视为这样的风险。实际上，德国、奥地利或瑞士2020年的死亡总数根本没有戏剧性增加，根据政治上无可怀疑的疾病控制中心（CDC），所有年龄组冠状病毒感染存活的可能性极高。\n\n更一般地说，在传染病风险评估方面，没有单一、明确、明确的科学答案。减少伤害的最好——最不昂贵和最有效——方法是分权决策。\n\n在私法社会，所有土地、房屋、道路、工厂等等都是私有的。就处理大流行而言，这只是一个'我让谁进来，谁不包括？'或'我去找谁，谁我避开。'的问题。\n\n基于他们对传染病风险评估，每个私人所有者或所有者协会必须决定我允许谁访问我的财产，何时和在什么条件下？这个决策可以并且将包括预防措施，特别是在商业使用财产（例如电影院、办公室、餐厅）的情况下。\n\n结果是访问和访问规则的复杂网络。"
                            },
                            {
                                "id": "5.9",
                                "question": "为什么私人组织发动的战争少于国家？",
                                "answer": "如果你对私法社会的想法是新的，你可能会发现很难思考战争和防御入侵者的问题。所以这里有一些关于这个主题的评论。\n\n如果你感兴趣，Hoppe和其他人已经写得更多了。\n\n国家是本质上比私人或私营公司更具侵略性的组织，原因很简单，他们可以将与侵略相关的成本外部化，即传递给穷纳税人。\n\n如果克林顿、布什、奥巴马或其他想要战争的政客必须自己支付成本，他们可能不会这样做。另一方面，对私营公司来说，战争是经济自杀。\n\n让我重复：正是民族国家仅在20世纪就负责数百万人的死亡和不可估量的破坏。相比之下，私人犯罪的受害者几乎可以忽略。"
                            },
                            {
                                "id": "5.10",
                                "question": "社会主义比私法社会更现实吗？",
                                "answer": "这里的问题不是政治可行性，而是哲学考虑：鉴于人类不能天使，哪种社会制度更适合人性？\n\n社会主义者是乌托邦主义者，因为他们假设随着社会主义的到来，人类本性也会发生转变。这当然是胡说八道，伪善的一厢情愿。\n\n另一方面，像我这样的自由主义者，是现实主义者。我们以人的现状接受他们——好和坏、和平和侵略、负责任和不负责任等等——并且不认为人性在根本上是可改变的。作为现实主义者，我们只确信激励在任何地方和总是有效的。"
                            }
                        ]
                    },
                    {
                        "id": "future",
                        "title": "未来",
                        "subtitle": "Future",
                        "quotes": [
                            {
                                "id": "6.1",
                                "question": "为什么不主张有限国家而不是完全没有国家？",
                                "answer": "是的，国家总是出现，有些更糟，有些更好。即使我们成功地废除它们，它们也可能再次出现。（现代自由主义之父Rothbard过去常常对此发表评论：至少我们会过一个光辉的假期）。\n\n但自由主义是一场无休止的斗争，一场争取自由的斗争。没有理由你应该放弃一个在道德上正确的目标。我们今天试图消除谋杀。我们会说因为仍有谋杀犯在周围而放弃那件事吗？不，我们永远不会放弃……\n\n我们主张适用于每个人的某些道德规则，我们主张这些规则，无论人的地位如何。每个人都理解如果你打我，如果你偷我的钱包，如果你烧毁我的房子，这是一种犯罪，一种可惩罚的犯罪。同样的标准应该适用于政治家。然后你得出结论，即使最好的政治家至少也是抢劫犯。\n\nMises Institute的创始人Lew Rockwell最初有想法说我们Mises Institute主张有限国家。我只是向他指出，没有机构主张无限国家。因此，即使从营销角度来说，说我们是那些根本不要国家的人也是有意义的。\n\n自由主义是寻求给国家尽可能少的功能，或根本没有任何功能。相反的是威权政策。"
                            },
                            {
                                "id": "6.2",
                                "question": "为什么我们需要'新阶级意识'？",
                                "answer": "问题是国家现在使很大一部分人口依赖它。在工业化国家，只有三分之一的人在收入方面仍然独立于国家。其余的是养老金领取者、公务员、净接收者、失业者或作为客户依靠国家生活的公司。他们都在选举中投票，让这种情况继续下去。\n\n我不期望从政治家那里得到任何东西。在我看来，重要的是人口中建立一种新的阶级意识，但不是共产主义阶级意识的意义，声称资本家在剥削工人。相反，人们必须意识到：国家是作恶者，国家剥削私营部门工作的所有人。\n\n一个被认可和对待的小偷不能维持很久。"
                            },
                            {
                                "id": "6.3",
                                "question": "对'朝着正确方向迈步'有希望吗？",
                                "answer": "无论如何，将会有经济崩溃，这个崩溃开启了分离主义运动的可能性。一个例子是苏联的崩溃和它分裂为许多独立国家。\n\n这就是希望。如果你认为欧洲很好，你必须支持在欧洲有数百个列支敦士登。因为国家会相互竞争，他们必须对人口相对友好，否则人口会简单地离开他们。相比之下，欧洲中央政府——更不用说世界政府——有'协调'税收和监管政策，是对自由的最大威胁。\n\n此外，私法社会的想法只有在我们在欧洲分权时才会发挥作用。\n\n所以：对任何形式的集权的抵抗和对任何形式的分离主义运动的支持。"
                            }
                        ]
                    },
                    {
                        "id": "development",
                        "title": "智力发展",
                        "subtitle": "Intellectual Development",
                        "quotes": [
                            {
                                "id": "7.1",
                                "question": "从左派到古典自由主义者",
                                "answer": "在高中时我是一个左派，我被左派思想、马克思主义思想所吸引，因为它具有演绎性质。我试图创建一个系统来理解所有现象及其相互关系，这就是为什么我在1968年学生叛乱的顶峰时期去法兰克福大学。这就是为什么我首先选择一个左派老师。我的博士导师是Jürgen Habermas，一个著名的左派哲学家。\n\n我在第一学期变得非常失望，发现马克思主义系统的主要缺陷。我在智力上漂流，直到遇到Karl Popper，他主张普遍怀疑主义并否认绝对真理。万物在某种程度上都是假设的或者只是重言式。\n\n通过在流行媒体中阅读Milton Friedman，我成为自由市场的信徒，但在我对演绎系统的既定追求中，我自然对Friedman不是很满意。我很快发现他的思想存在巨大的不一致，这使我感到不满。\n\n然后我发现了Friedrich von Hayek，他避免了一些这些不一致，但绝不是全部。我应该提到，我的任何老师都没有向我指出Friedman或Hayek。\n\n正是通过Hayek的脚注，我终于发现了Ludwig von Mises。那时候我开始写一本书，后来成为我关于一般社会科学方法论的资格论文。我怀疑经济学家对他们自己学科所说的，即他们的陈述仅仅是假设。我认为像关于货币供应这样的陈述包含的不仅仅是假设意义上的真实，但我发现没有经济学家这么说。\n\n然后，当我阅读Mises的巨著《人类行为》时，我意识到他说了完全相同的事情，即经济陈述是Kant和其他哲学家称之为'综合先天陈述'的东西，即它们在正常可测试性的意义上不可测试，但它们确实说了一些关于真实对象的东西，我立即成为了Mises主义者。"
                            },
                            {
                                "id": "7.2",
                                "question": "从古典自由主义者到私有财产无政府主义者",
                                "answer": "准确地说，我通过一个有趣的巧合发现Mises。我的父母都是东德难民，我母亲家族的财产在1946年被俄国人征收。他们最初生活在东德的一个地区，那里被美国人占领，当美国人用那个省换取后来成为西柏林的东西时，俄国人搬进来并接管了所有大地主的财产，包括我母亲家族的财产。但我的大多数亲戚都住在东德，我们定期拜访他们。\n\n你必须支付进入工人和农民天堂的费用（通过兑换西德马克为东德马克）。由于我们与亲戚住在一起，我们必须以某种方式花钱，只有两种方法可以做到这一点。一种是购买俄罗斯作曲家的俄罗斯唱片，另一种是购买列宁、斯大林以及东德总理Walter Ulbricht和 его 继任者Erich Honecker的文选。\n\n我的一个书籍购买是他们用来培训学生的政治经济学文本，在这本书中列出了社会主义的所有主要敌人。例如，他们不仅提到了我之前熟悉的Böhm-Bawerk，而且作为最邪恶的，Ludwig von Mises。那时候我没有立即开始阅读Ludwig von Mises，但我意识到在某个时候值得更仔细地看待他。同时，在西德的经济学教科书中都没有提到Hayek或Mises的名字。\n\n至于政治哲学，当然我发现在Mises中存在某些不一致，即使它们与Hayek或Friedman相比是最小的。通过阅读Mises，然后我意识到他的主要学生Murray Rothbard住在美国，他已经消除了Mises的不一致，我成为了Rothbardian。"
                            },
                            {
                                "id": "7.3",
                                "question": "我对科学的贡献",
                                "answer": "我的主要贡献首先是比Rothbard更好的自然法 justification。他认为有Mises行动公理作为必要的起点，我指出在行动公理的意义上有一个更基本的起点，即通过谈论行动公理我们必须论证。因此行动公理有一个子类别，即论证先天。你不能否认你在论证而不自相矛盾，所以这里有依赖任何和所有讨论的东西：是否有伦理或没有伦理，人是否行动或不行动？当然，所有这一切都要求我们能够论证。\n\n我的哲学老师Habermas和Karl-Otto Apel谈论沟通先天，但他们没有看到和意识到，我认为我意识到的是，任何论证都有一些客观的物理要求，在任何论证中你需要对某些稀缺资源有个人控制（声带、站立空间、维持话语的食物）。之后你可以显示任何事物的直接占有逻辑上先于任何事物的间接占有，然后你可以从中推导出整个伦理体系。我认为这是我政治哲学、科学哲学的主要贡献：将伦理基础建立在新的基础上。\n\nHabermas是我在1968年到1974年在法兰克福歌德大学学习期间最重要的哲学老师和博士导师，通过他的研讨会，我熟悉了英美分析哲学。我仍然认为这是一个相当好的智力训练。"
                            }
                        ]
                    }
                ]
            };
            this.currentQuotes = this.getAllQuotes();
            this.filteredQuotes = [...this.currentQuotes];
        } catch (error) {
            console.error('加载数据时出错:', error);
            throw error;
        }
    }
    
    getAllQuotes() {
        const allQuotes = [];
        this.data.chapters.forEach(chapter => {
            chapter.quotes.forEach(quote => {
                allQuotes.push({
                    ...quote,
                    chapterId: chapter.id,
                    chapterTitle: chapter.title,
                    chapterSubtitle: chapter.subtitle
                });
            });
        });
        return allQuotes;
    }
    
    setupEventListeners() {
        // 菜单控制
        this.elements.sidebarBackBtn.addEventListener('click', () => this.closeSidebar());
        this.elements.menuToggle.addEventListener('click', () => this.openSidebar());
        
        // Hoppe介绍页面
        this.elements.hoppeIntroBtn.addEventListener('click', (e) => {
            e.preventDefault();
            this.showHoppeInfo();
        });
        this.elements.hoppeInfoClose.addEventListener('click', () => this.closeHoppeInfo());
        this.elements.hoppeInfoModal.addEventListener('click', (e) => {
            if (e.target === this.elements.hoppeInfoModal) {
                this.closeHoppeInfo();
            }
        });
        
        // 搜索功能
        // 闪卡控制
        this.elements.randomBtn.addEventListener('click', () => this.showRandomCard());
        this.elements.nextBtn.addEventListener('click', () => this.nextCard());
        this.elements.prevBtn.addEventListener('click', () => this.prevCard());
        
        // 键盘快捷键
        document.addEventListener('keydown', (e) => this.handleKeyboard(e));
        
        // 点击侧边栏外部关闭移动端菜单
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 && 
                this.elements.sidebar.classList.contains('open') && 
                !this.elements.sidebar.contains(e.target) && 
                !this.elements.menuToggle.contains(e.target)) {
                this.closeSidebar();
            }
        });
        
        // 响应式侧边栏控制
        window.addEventListener('resize', () => {
            // 保持当前状态，不需要特殊处理
        });
    }
    
    setupNavigation() {
        const navHtml = this.data.chapters.map((chapter, chapterIndex) => {
            const quotesHtml = chapter.quotes.map((quote, index) => `
                <a href="#" class="quote-link" data-chapter="${chapter.id}" data-quote="${quote.id}">
                    <div class="quote-number">${index + 1}</div>
                    <div class="quote-preview">${quote.question.length > 20 ? quote.question.substring(0, 20) + '...' : quote.question}</div>
                </a>
            `).join('');
            
            // 默认展开第一个章节
            const isExpanded = chapterIndex === 0 ? 'expanded' : '';
            
            return `
                <div class="chapter-group ${isExpanded}">
                    <div class="chapter-header" data-chapter="${chapter.id}">
                        <div class="chapter-info">
                            <div class="chapter-title">${chapter.title}</div>
                            <div class="chapter-subtitle">${chapter.subtitle}</div>
                        </div>
                        <div class="chapter-toggle">
                            <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9,18 15,12 9,6"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div class="quotes-list">
                        ${quotesHtml}
                    </div>
                </div>
            `;
        }).join('');
        
        this.elements.chapterNav.innerHTML = navHtml;
        
        // 设置第一个章节的箭头方向
        const firstToggle = this.elements.chapterNav.querySelector('.chapter-group.expanded .toggle-icon');
        if (firstToggle) {
            firstToggle.style.transform = 'rotate(90deg)';
        }
        
        // 章节组点击事件（展开/收起）
        this.elements.chapterNav.addEventListener('click', (e) => {
            const chapterHeader = e.target.closest('.chapter-header');
            const quoteLink = e.target.closest('.quote-link');
            const chapterToggle = e.target.closest('.chapter-toggle');
            
            // 如果点击的是展开/收起图标，只处理展开/收起
            if (chapterHeader && !chapterToggle) {
                e.preventDefault();
                const chapterId = chapterHeader.dataset.chapter;
                const group = chapterHeader.parentElement;
                const toggle = chapterHeader.querySelector('.toggle-icon');
                
                // 如果当前是收起状态，展开并显示该章节
                if (!group.classList.contains('expanded')) {
                    group.classList.add('expanded');
                    toggle.style.transform = 'rotate(90deg)';
                }
                
                // 选择该章节（但保持侧边栏打开，让用户看到卡片列表）
                this.showChapter(chapterId);
                this.updateActiveChapter(chapterId);
                return;
            }
            
            // 处理展开/收起图标点击
            if (chapterToggle) {
                e.preventDefault();
                const group = chapterHeader.parentElement;
                const toggle = chapterHeader.querySelector('.toggle-icon');
                
                if (group.classList.contains('expanded')) {
                    group.classList.remove('expanded');
                    toggle.style.transform = 'rotate(0deg)';
                } else {
                    group.classList.add('expanded');
                    toggle.style.transform = 'rotate(90deg)';
                }
            }
            
            // 处理语录链接点击
            if (quoteLink) {
                e.preventDefault();
                const chapterId = quoteLink.dataset.chapter;
                const quoteId = quoteLink.dataset.quote;
                
                this.showSpecificQuote(chapterId, quoteId);
                this.updateActiveChapter(chapterId);
                this.closeSidebar();
            }
        });
    }
    
    updateActiveChapter(chapterId) {
        document.querySelectorAll('.chapter-link, .quote-link').forEach(link => {
            link.classList.remove('active');
        });
        
        // 高亮当前章节
        const activeChapter = document.querySelector(`[data-chapter="${chapterId}"].chapter-header`);
        if (activeChapter) {
            activeChapter.classList.add('active');
        }
    }
    
    showSpecificQuote(chapterId, quoteId) {
        const chapter = this.data.chapters.find(c => c.id === chapterId);
        if (!chapter) return;
        
        const quote = chapter.quotes.find(q => q.id === quoteId);
        if (!quote) return;
        
        // 保存当前状态
        this.activeChapterId = chapterId;
        
        // 重新构建当前语录列表，只包含该章节
        this.buildCurrentQuotes();
        
        // 找到指定quote在filteredQuotes中的正确位置
        this.currentIndex = this.filteredQuotes.findIndex(q => q.id === quoteId);
        if (this.currentIndex === -1) {
            this.currentIndex = 0; // 如果没找到，设为第一个
        }
        
        this.updateDisplay();
        this.showToast(`已跳转到「${chapter.title}」的特定语录`, 'success');
        
        // 更新活跃章节状态
        this.updateActiveChapter(chapterId);
    }
    
    showRandomCard() {
        // 随机抽取总是从所有卡片中进行，不受当前章节过滤影响
        const allQuotes = this.getAllQuotes();
        if (allQuotes.length === 0) {
            this.showToast('没有找到语录', 'warning');
            return;
        }
        
        // 在所有卡片中随机选择
        const randomIndex = Math.floor(Math.random() * allQuotes.length);
        const selectedQuote = allQuotes[randomIndex];
        
        // 如果随机选中的卡片不在当前过滤列表中，更新currentQuotes
        const currentQuote = this.filteredQuotes[this.currentIndex];
        if (!currentQuote || currentQuote.id !== selectedQuote.id) {
            // 找到选中卡片在filteredQuotes中的位置
            const newFilteredIndex = this.filteredQuotes.findIndex(q => q.id === selectedQuote.id);
            if (newFilteredIndex !== -1) {
                this.currentIndex = newFilteredIndex;
            } else {
                // 如果当前有章节过滤，选中的卡片不在当前章节，则重置过滤
                this.activeChapterId = null;
                this.buildCurrentQuotes();
                this.currentIndex = this.filteredQuotes.findIndex(q => q.id === selectedQuote.id);
            }
        }
        
        this.updateDisplay();
        this.showToast('随机抽取了一张新语录', 'success');
    }
    
    nextCard() {
        if (this.filteredQuotes.length === 0) {
            this.showToast('没有可显示的语录', 'warning');
            return;
        }
        
        if (this.currentIndex < this.filteredQuotes.length - 1) {
            // 在当前章节内继续翻页
            this.currentIndex++;
            this.updateDisplay();
        } else {
            // 到达当前章节末尾，跳转到下一章节
            this.navigateToNextChapter();
        }
    }
    
    prevCard() {
        if (this.filteredQuotes.length === 0) {
            this.showToast('没有可显示的语录', 'warning');
            return;
        }
        
        if (this.currentIndex > 0) {
            // 在当前章节内继续翻页
            this.currentIndex--;
            this.updateDisplay();
        } else {
            // 到达当前章节开始，跳转到上一章节
            this.navigateToPrevChapter();
        }
    }
    
    navigateToNextChapter() {
        if (!this.activeChapterId || !this.data) return;
        
        const currentChapterIndex = this.data.chapters.findIndex(c => c.id === this.activeChapterId);
        if (currentChapterIndex === -1) return;
        
        // 如果有下一章节
        if (currentChapterIndex < this.data.chapters.length - 1) {
            const nextChapter = this.data.chapters[currentChapterIndex + 1];
            this.activeChapterId = nextChapter.id;
            this.buildCurrentQuotes();
            this.currentIndex = 0; // 跳转到下一章节的第一张
            this.updateDisplay();
            this.updateActiveChapter(nextChapter.id);
            this.showToast(`已跳转到下一章节：${nextChapter.title}`, 'info');
        } else {
            // 已经是最后一个章节
            this.showToast('已经是最后一个章节了', 'info');
        }
    }
    
    navigateToPrevChapter() {
        if (!this.activeChapterId || !this.data) return;
        
        const currentChapterIndex = this.data.chapters.findIndex(c => c.id === this.activeChapterId);
        if (currentChapterIndex === -1) return;
        
        // 如果有上一章节
        if (currentChapterIndex > 0) {
            const prevChapter = this.data.chapters[currentChapterIndex - 1];
            this.activeChapterId = prevChapter.id;
            this.buildCurrentQuotes();
            this.currentIndex = this.filteredQuotes.length - 1; // 跳转到上一章节的最后一张
            this.updateDisplay();
            this.updateActiveChapter(prevChapter.id);
            this.showToast(`已跳转到上一章节：${prevChapter.title}`, 'info');
        } else {
            // 已经是第一个章节
            this.showToast('已经是第一个章节了', 'info');
        }
    }
    
    showChapter(chapterId) {
        const chapter = this.data.chapters.find(c => c.id === chapterId);
        if (!chapter) return;
        
        // 保存当前状态
        const wasFromChapter = this.activeChapterId === chapterId;
        this.activeChapterId = chapterId;
        
        if (!wasFromChapter) {
            this.showToast(`已选择「${chapter.title}」章节，当前将显示该章节内容`, 'success');
        }
        
        // 重新构建当前语录列表，只应用章节过滤
        this.buildCurrentQuotes();
        this.updateDisplay();
        this.updateActiveChapter(chapterId);
    }
    
    // 构建当前语录列表，应用章节过滤
    buildCurrentQuotes() {
        // 起始语录列表
        let quotes = this.getAllQuotes();
        
        // 应用章节过滤
        if (this.activeChapterId) {
            quotes = quotes.filter(q => q.chapterId === this.activeChapterId);
        }
        
        this.filteredQuotes = quotes;
        
        // 调整当前索引
        if (this.currentIndex >= this.filteredQuotes.length) {
            this.currentIndex = Math.max(0, this.filteredQuotes.length - 1);
        }
    }
    

    

    
    updateDisplay() {
        if (this.filteredQuotes.length === 0) {
            this.showEmptyState();
            return;
        }
        
        const currentQuote = this.filteredQuotes[this.currentIndex];
        const originalIndex = this.currentQuotes.findIndex(q => q.id === currentQuote.id);
        
        // 更新内容
        this.elements.chapterName.textContent = currentQuote.chapterTitle;
        this.elements.question.textContent = currentQuote.question;
        this.elements.answer.textContent = currentQuote.answer;
        
        // 更新章节激活状态
        this.updateActiveChapter(currentQuote.chapterId);
        
        // 添加动画效果
        this.addCardAnimation();
    }
    
    showEmptyState() {
        this.elements.question.textContent = '没有找到匹配的语录';
        this.elements.answer.textContent = '请选择其他章节。';
        this.elements.chapterName.textContent = '';
    }
    
    addCardAnimation() {
        this.elements.flashcard.style.opacity = '0.7';
        this.elements.flashcard.style.transform = 'translateY(10px)';
        
        setTimeout(() => {
            this.elements.flashcard.style.opacity = '1';
            this.elements.flashcard.style.transform = 'translateY(0)';
        }, 100);
    }
    
    handleKeyboard(e) {
        // 如果正在输入，不处理快捷键
        if (e.target.tagName === 'INPUT') return;
        
        switch (e.key) {
            case 'ArrowLeft':
                e.preventDefault();
                this.prevCard();
                break;
            case 'ArrowRight':
                e.preventDefault();
                this.nextCard();
                break;
            case ' ':
            case 'Enter':
                e.preventDefault();
                this.showRandomCard();
                break;

            case 'Escape':
                this.closeSidebar();
                break;
        }
    }
    
    openSidebar() {
        this.elements.sidebar.classList.add('open');
        this.elements.menuToggle.setAttribute('aria-expanded', 'true');
    }
    
    closeSidebar() {
        this.elements.sidebar.classList.remove('open');
        this.elements.menuToggle.setAttribute('aria-expanded', 'false');
    }
    
    showHoppeInfo() {
        this.elements.hoppeInfoModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    
    closeHoppeInfo() {
        this.elements.hoppeInfoModal.style.display = 'none';
        document.body.style.overflow = '';
    }
    

    
    showToast(message, type = 'info') {
        const toast = this.elements.toast;
        toast.textContent = message;
        toast.className = `toast ${type}`;
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }
    
    hideLoading() {
        this.elements.loading.classList.add('hidden');
    }
}

// 页面加载完成后初始化应用
document.addEventListener('DOMContentLoaded', () => {
    new HoppeFlashcards();
});

// 错误处理
window.addEventListener('error', (e) => {
    console.error('页面错误:', e.error);
});

window.addEventListener('unhandledrejection', (e) => {
    console.error('未处理的Promise拒绝:', e.reason);
});

// 导出给其他脚本使用（如果需要）
if (typeof module !== 'undefined' && module.exports) {
    module.exports = HoppeFlashcards;
}
